generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  TRADE
  CLIENT
  ADMIN
}

enum ServiceCategory {
  PLUMBER
  ELECTRICIAN
  CARPENTER
  PAINTER
  BUILDER
  ROOFER
  PLASTERER
  TILER
  LANDSCAPER
  WINDOW_CLEANER
  HANDYMAN
  CLEANER
  MOBILE_BARBER
  MOBILE_BEAUTICIAN
  MASSAGE_THERAPIST
  PERSONAL_TRAINER
  MOBILE_MECHANIC
  IT_SUPPORT
  PHOTOGRAPHER
  OTHER
}

enum EnquiryStatus {
  PENDING
  ACCEPTED
  DECLINED
  CONTACTED
}

enum EnquiryUrgency {
  ASAP
  TODAY
  THIS_WEEK
  BY_DATE
  FLEXIBLE
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password      String
  role          UserRole  @default(CLIENT)
  name          String
  phone         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  tradeProfile  TradeProfile?
  enquiries     Enquiry[]
  
  @@index([email])
}

model TradeProfile {
  id                String          @id @default(cuid())
  userId            String          @unique
  user              User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  businessName      String
  category          ServiceCategory
  description       String
  postcode          String
  serviceRadius     Int             @default(10)
  
  verified          Boolean       @default(false)
  active            Boolean       @default(true)
  
  enquiriesReceived Int           @default(0)
  enquiriesResponded Int          @default(0)
  enquiriesAccepted Int           @default(0)
  averageResponseTime Int?
  lastActive        DateTime      @default(now())
  
  freeUntil         Int           @default(3)
  subscriptionActive Boolean      @default(false)
  subscriptionEnds  DateTime?
  
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  
  receivedEnquiries Enquiry[]
  
  @@index([postcode])
  @@index([category])
  @@index([verified])
}

model Enquiry {
  id              String         @id @default(cuid())
  
  clientId        String
  client          User           @relation(fields: [clientId], references: [id], onDelete: Cascade)
  
  tradeProfileId  String
  tradeProfile    TradeProfile   @relation(fields: [tradeProfileId], references: [id], onDelete: Cascade)
  
  clientName      String
  clientEmail     String
  clientPhone     String
  clientPostcode  String
  
  jobDescription  String
  urgency         EnquiryUrgency? @default(FLEXIBLE)
  preferredDate   String?
  status          EnquiryStatus   @default(PENDING)
  
  respondedAt     DateTime?
  
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  
  @@index([tradeProfileId])
  @@index([clientId])
  @@index([status])
}
